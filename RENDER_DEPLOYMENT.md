# BizPilot v2.0 - Render Deployment Guide

## üöÄ Quick Deploy to Render

This guide will help you deploy BizPilot to Render using the included Blueprint configuration.

## Prerequisites

- GitHub account with BizPilot2 repository
- Render account (free at https://render.com)
- Google OAuth credentials (optional, for social login)

---

## Deployment Methods

### Method 1: Blueprint Deployment (Recommended) ‚ö°

This is the fastest method - Render will automatically create all services from the `render.yaml` file.

#### Step 1: Connect Repository

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click **"New"** ‚Üí **"Blueprint"**
3. Connect your GitHub account if not already connected
4. Select the **BizPilot2** repository
5. Choose branch: **`dev`** or **`main`**

#### Step 2: Review Blueprint Configuration

Render will show you the services it will create:
- ‚úÖ **bizpilot-api** (Backend API)
- ‚úÖ **bizpilot-web** (Frontend)
- ‚úÖ **bizpilot-db** (PostgreSQL Database)

Click **"Apply"** to create all services.

#### Step 3: Configure Environment Variables

After services are created, you need to configure some environment variables:

##### Backend (bizpilot-api):

1. Go to **bizpilot-api** service ‚Üí **Environment**
2. Add/Update these variables:

**Required:**
```env
# Already set by Blueprint, verify:
DATABASE_URL=<auto-filled from database>
SECRET_KEY=<auto-generated>
ENVIRONMENT=production
DEBUG=false
CORS_ORIGINS=["https://bizpilot-web.onrender.com"]
```

**Optional (for email):**
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
```

**Optional (for Google OAuth):**
```env
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=https://bizpilot-api.onrender.com/api/v1/oauth/google/callback
```

##### Frontend (bizpilot-web):

1. Go to **bizpilot-web** service ‚Üí **Environment**
2. Verify these variables:

```env
NEXT_PUBLIC_API_URL=https://bizpilot-api.onrender.com/api/v1
NEXTAUTH_URL=https://bizpilot-web.onrender.com
NEXTAUTH_SECRET=<auto-generated>
NODE_ENV=production
```

**Optional (for Google OAuth - must match backend):**
```env
GOOGLE_CLIENT_ID=same-as-backend
GOOGLE_CLIENT_SECRET=same-as-backend
```

#### Step 4: Wait for Deployment

- Backend will take ~5-10 minutes to build and deploy
- Frontend will take ~8-15 minutes to build and deploy
- Database is ready immediately

Monitor progress in the **Logs** tab of each service.

#### Step 5: Access Your Application

Once deployed:
- **Frontend**: `https://bizpilot-web.onrender.com`
- **Backend API**: `https://bizpilot-api.onrender.com/docs`
- **Health Check**: `https://bizpilot-api.onrender.com/health`

---

### Method 2: Manual Deployment üîß

If you prefer to create services individually:

#### Step 1: Create PostgreSQL Database

1. Dashboard ‚Üí **"New"** ‚Üí **"PostgreSQL"**
2. Configure:
   - **Name**: `bizpilot-db`
   - **Database**: `bizpilot`
   - **User**: `bizpilot`
   - **Region**: Choose closest to you
   - **Plan**: Starter ($7/month) or Free
3. Click **"Create Database"**
4. Copy the **"Internal Database URL"** (starts with `postgresql://`)

#### Step 2: Deploy Backend API

1. Dashboard ‚Üí **"New"** ‚Üí **"Web Service"**
2. Connect your GitHub repository
3. Configure:
   - **Name**: `bizpilot-api`
   - **Region**: Same as database
   - **Branch**: `dev` or `main`
   - **Runtime**: Docker
   - **Dockerfile Path**: `./infrastructure/docker/Dockerfile.api`
   - **Docker Build Context Directory**: `./backend`
   - **Plan**: Starter ($7/month) or Free

4. Add Environment Variables:
   ```env
   DATABASE_URL=<paste Internal Database URL>
   SECRET_KEY=<generate: openssl rand -hex 32>
   ENVIRONMENT=production
   DEBUG=false
   CORS_ORIGINS=["https://bizpilot-web.onrender.com"]
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=30
   ```

5. **Advanced** ‚Üí **Health Check Path**: `/health`
6. Click **"Create Web Service"**

#### Step 3: Deploy Frontend

1. Dashboard ‚Üí **"New"** ‚Üí **"Web Service"**
2. Connect your GitHub repository
3. Configure:
   - **Name**: `bizpilot-web`
   - **Region**: Same as backend
   - **Branch**: `dev` or `main`
   - **Runtime**: Docker
   - **Dockerfile Path**: `./infrastructure/docker/Dockerfile.web`
   - **Docker Build Context Directory**: `./frontend`
   - **Plan**: Starter ($7/month) or Free

4. Add Environment Variables:
   ```env
   NEXT_PUBLIC_API_URL=https://bizpilot-api.onrender.com/api/v1
   NEXTAUTH_URL=https://bizpilot-web.onrender.com
   NEXTAUTH_SECRET=<generate: openssl rand -hex 32>
   NODE_ENV=production
   ```

5. Click **"Create Web Service"**

---

## üîê Setting Up Google OAuth (Optional)

### Step 1: Create Google OAuth Credentials

1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Create a new project or select existing
3. Enable **Google+ API**
4. Go to **Credentials** ‚Üí **Create Credentials** ‚Üí **OAuth 2.0 Client ID**
5. Configure:
   - **Application type**: Web application
   - **Name**: BizPilot Production
   - **Authorized redirect URIs**:
     - `https://bizpilot-api.onrender.com/api/v1/oauth/google/callback`
     - `https://bizpilot-web.onrender.com/api/auth/callback/google`

6. Copy **Client ID** and **Client Secret**

### Step 2: Update Render Environment Variables

Add to both **bizpilot-api** and **bizpilot-web**:
```env
GOOGLE_CLIENT_ID=your-client-id-here
GOOGLE_CLIENT_SECRET=your-client-secret-here
```

For **bizpilot-api** only:
```env
GOOGLE_REDIRECT_URI=https://bizpilot-api.onrender.com/api/v1/oauth/google/callback
```

---

## üìä Database Migrations

Database migrations run automatically when the backend starts up! The production Dockerfile includes:
```dockerfile
CMD alembic upgrade head && uvicorn app.main:app ...
```

To manually run migrations:
1. Go to **bizpilot-api** service
2. Click **"Shell"** tab
3. Run: `alembic upgrade head`

---

## üîç Monitoring & Troubleshooting

### View Logs

1. Go to service (bizpilot-api or bizpilot-web)
2. Click **"Logs"** tab
3. Use filters to search specific errors

### Common Issues

#### Backend won't start
- ‚úÖ Check DATABASE_URL is set correctly
- ‚úÖ Check SECRET_KEY is generated
- ‚úÖ Review logs for migration errors

#### Frontend shows API errors
- ‚úÖ Verify NEXT_PUBLIC_API_URL points to backend
- ‚úÖ Check CORS_ORIGINS includes frontend URL
- ‚úÖ Test backend health: `https://bizpilot-api.onrender.com/health`

#### Database connection errors
- ‚úÖ Use **Internal Database URL** (not external)
- ‚úÖ Check database is in same region as backend
- ‚úÖ Verify database is running (green status)

#### OAuth not working
- ‚úÖ Verify Google credentials are correct
- ‚úÖ Check redirect URIs match exactly in Google Console
- ‚úÖ Ensure both backend and frontend have same credentials

---

## üí∞ Pricing Considerations

### Free Tier
- **Database**: 1GB storage, shared CPU
- **Services**: Spin down after inactivity, 750 hrs/month
- **Total**: $0/month

**Note**: Free services spin down after 15 minutes of inactivity and take ~30 seconds to wake up.

### Starter Tier (Recommended for Production)
- **Database Starter**: $7/month (always on)
- **API Starter**: $7/month (always on)
- **Web Starter**: $7/month (always on)
- **Total**: $21/month

### Custom Domain

1. Go to service **Settings**
2. Scroll to **Custom Domain**
3. Add your domain: `app.yourdomain.com`
4. Update DNS records as shown
5. SSL certificate is automatic!

---

## üîÑ Auto-Deploy

Render automatically deploys when you push to your connected branch!

**Configure auto-deploy:**
1. Go to service **Settings**
2. **Auto-Deploy**: Yes
3. **Branch**: dev (or main)

**Build paths** (already configured in render.yaml):
- Backend: Only deploys on changes to `backend/**`
- Frontend: Only deploys on changes to `frontend/**`

---

## üì± Post-Deployment Checklist

- [ ] Backend health check returns 200: `https://bizpilot-api.onrender.com/health`
- [ ] API docs accessible: `https://bizpilot-api.onrender.com/docs`
- [ ] Frontend loads: `https://bizpilot-web.onrender.com`
- [ ] Can register new user
- [ ] Can login with email/password
- [ ] Google OAuth works (if configured)
- [ ] Database migrations completed successfully
- [ ] Environment variables are secure (no secrets exposed)

---

## üö® Security Reminders

- ‚úÖ Never commit `.env` files with secrets
- ‚úÖ Use Render's environment variables for all secrets
- ‚úÖ Enable **IP Allowlist** on database for production
- ‚úÖ Use **Starter** or higher plan for always-on production apps
- ‚úÖ Regularly rotate SECRET_KEY and NEXTAUTH_SECRET
- ‚úÖ Monitor logs for suspicious activity

---

## üìû Support

- **Render Docs**: https://render.com/docs
- **Render Status**: https://status.render.com
- **BizPilot Issues**: https://github.com/BrightonDube/BizPilot2/issues

---

## üéâ Success!

Your BizPilot application is now live on Render! 

**Next Steps:**
1. Create your first organization
2. Add team members
3. Start managing your business
4. Consider upgrading to Starter plans for production use

Happy business managing! üöÄ
